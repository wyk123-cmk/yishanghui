(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/vehicleMail/createOrder"],{"32e2":function(e,t,s){"use strict";(function(e){s("b397");i(s("66fd"));var t=i(s("ef39"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,s("543d")["createPage"])},"33a4":function(e,t,s){},"6f06":function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){s.e("components/sendTime-picker/sendTime-picker").then(function(){return resolve(s("a768"))}.bind(null,s)).catch(s.oe)},n={data:function(){return{sendInfo:{name:"寄件人信息",contactsCode:"",address:"点击填写寄件地址",ad:"",areaCode:""},repInfo:{},expressTypeData:["个人"],expressTypeIndex:0,expressCompany:{list:[],range:[],index:0,code:"",path:"",agreementUrl:"",companyName:"",insuranceUpper:0},popupShow:!1,startTime:8,endTime:19,setPickerIndex:[0],timeTabIndex:0,sendTime:"一小时内",isClause:!1,isAagree:!1,insuredPrice:null,serviceNames:"",serviceList:[],goodInfoData:{},goodName:"",checkedAgree:!1,isCarType:!1,carList:[],carSubList:[],swiperItems:1,swiperIndex:0,carIndex:0,carCode:"",carName:"",clauseHtml:"",agreeHtml:"",tabTimeArr:[]}},components:{sendTimePicker:i},onLoad:function(){this.showImage=getApp().globalData.isDiscountPopup,this.isRegister(),this.getExpressCompany(),this.getYshESAgree(),this.getYMD()},onShow:function(){this.init()},methods:{init:function(){var e=this,t=this.$store.state.expressDeliveryInfo,s=t.sendAddress,i=t.repAddress,n=t.goodInfo,r=t.insuredPrice,a=t.service,o=t.carType;if(this.goodInfoData={},this.insuredPrice=null,"{}"==JSON.stringify(s)?this.getDefault():this.sendInfo=s,"{}"==JSON.stringify(i)?this.repInfo={name:"收件人信息",contactsCode:"",address:"点击填写收件地址",ad:"",areaCode:""}:this.repInfo=i,""!=t.type&&(this.expressTypeIndex=t.type),""!=t.companyCode)for(var c=0;c<this.expressCompany.list.length;c++)this.expressCompany.list[c].companyCode==t.companyCode&&this.setCompanyValue(c);if("{}"!=JSON.stringify(n)&&(this.goodInfoData=n,this.goodName=n.goodName),"{}"!=JSON.stringify(r)&&(this.insuredPrice=r),"{}"!=JSON.stringify(o)&&(this.carIndex=o.carIndex,this.swiperIndex=o.swiperIndex,this.carName=this.carList[this.swiperIndex].carName,this.carCode=this.carSubList[this.carIndex].carCode),"{}"!=JSON.stringify(a)){this.serviceList=[];var p="";a.forEach((function(t){var s=t.sub.remark.replace(/ /g,"");p+=s+"-",e.serviceList.push(t.sub),"PayType"==t.sub.serviceKey&&(e.paytype=t.sub.remark)})),this.serviceNames=p.substring(0,p.length-1)}},createOrderBtn:function(){var t=this;if(!t.Valid())return!1;var s=0==t.expressTypeIndex?1:2,i=this.expectedTime(),n="";if(null!=t.insuredPrice)n=t.insuredPrice.amount;var r={fromContactsCode:t.sendInfo.contactsCode,toContactsCode:t.repInfo.contactsCode,companyCode:t.expressCompany.code,sendTime:i,goodsInfo:{weight:t.goodInfoData.weigth,volume:t.goodInfoData.cubic<=0?0:t.goodInfoData.cubic,category:t.goodInfoData.packType,name:t.goodInfoData.goodName,count:t.goodInfoData.goodNum},insurance:n,insuranceCompanyCode:t.expressCompany.code,expressMode:s,remark:t.goodInfoData.remark,serviceList:t.serviceList,carCode:t.carCode};e.showLoading({mask:!0,title:"正在下单.."}),t.$util.networkRequest({url:"/ExpressCar/Create",method:"POST",data:r,success:function(s){t.emptyData(),e.redirectTo({url:"details?mastCode="+s.mastCode})},error:function(e){console.log("error:",e)}})},addressPage:function(t,s){if(0==t){var i="";"send"==s&&(i=this.sendInfo.contactsCode),"rep"==s&&(i=this.repInfo.contactsCode),e.navigateTo({url:"/pages/me/addressEdit?addresscode="+i+"&type="+s})}1==t&&e.navigateTo({url:"/pages/me/addressList?type="+s})},expressTypeChange:function(e){this.$store.state.expressDeliveryInfo.type=this.expressTypeIndex=e},goInsuredPrice:function(){if(""==this.expressCompany.code||null==this.expressCompany.code)return this.$util.showToast("请选择物流公司"),!1;e.navigateTo({url:"/pages/vehicleMail/insured?upperAmount="+this.expressCompany.insuranceUpper+"&code="+this.expressCompany.code+"&mark=1"})},goService:function(){e.navigateTo({url:"/pages/index/addedService?code="+this.expressCompany.code+"&type=2"})},swiperClick:function(e){this.swiperIndex=e,this.carSubList=this.carList[e].list,this.carName="",this.carIndex=0},choiceCar:function(e,t){this.carIndex=e,this.carCode=t},carBtn:function(){this.isCarType=!1,this.carName=this.carList[this.swiperIndex].carName,this.$store.state.expressDeliveryInfo.carType={swiperIndex:this.swiperIndex,carIndex:this.carIndex}},expressCompanyPickerChange:function(e){var t=e.detail.value;this.productType="",this.$store.state.expressDeliveryInfo.expectTime="",this.setCompanyValue(t),this.$store.state.expressDeliveryInfo.companyCode=this.expressCompany.list[t].companyCode,this.$store.state.expressDeliveryInfo.service={},this.serviceNames="",this.initServiceData(),this.$store.state.expressDeliveryInfo.carType={},this.getCarListAll()},setCompanyValue:function(e){var t=this.expressCompany.list[e].companyCode,s=this.expressCompany.list[e].startTime,i=this.expressCompany.list[e].endTime,n=this.expressCompany.list[e].logoPath,r=this.expressCompany.list[e].agreementUrl;this.expressCompany.index=e,this.expressCompany.code=t,this.expressCompany.path=n.replace(/\s*/g,""),this.expressCompany.agreementUrl=r,this.expressCompany.companyName=this.expressCompany.list[e].companyName,this.expressCompany.insuranceUpper=this.expressCompany.list[e].insuranceUpper,this.clauseHtml=this.expressCompany.list[e].agreementContent,this.startTime=s,this.endTime=i,this.setPickerIndex=[0],""!=this.$store.state.expressDeliveryInfo.expectTime?this.sendTime=this.$store.state.expressDeliveryInfo.expectTime:this.setDate(t,i)},open:function(){this.popupShow=!0},close:function(){this.popupShow=!1},timeChange:function(e){this.setPickerIndex=[Number(e.pickerIndex)],this.sendTime=e.txt,this.timeTabIndex=e.tabIndex,this.$store.state.expressDeliveryInfo.expectTime=this.sendTime},setDate:function(e,t){var s=new Date;s.getHours()>=this.endTime-1&&("sf001"==e||""==e||"ky001"==e)?this.timeTabIndex=1:s.getHours()>=this.endTime-2&&"db001"==e?this.timeTabIndex=1:this.timeTabIndex=0;var i=0==this.timeTabIndex?"":"明天";this.sendTime=""==e||"sf001"==e||"ky001"==e?i+" 一小时内":i+" 两小时内"},expectedTime:function(){var e=new Date,t="",s="";if(-1!=this.sendTime.indexOf("小时")){if(1==this.timeTabIndex)t=new Date(e.getTime()+864e5),s=this.startTime+":00";else{if("sf001"==this.expressCompany.code||"ky001"==this.expressCompany.code){if(this.endTime-1<(new Date).getHours()&&(new Date).getHours()<this.endTime)return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+this.endTime+":00";t=new Date(e.getTime()+36e5)}else{if(this.endTime-2<(new Date).getHours()&&(new Date).getHours()<this.endTime)return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+this.endTime+":00";t=new Date(e.getTime()+72e5)}s=t.getHours()+":"+t.getMinutes()}}else if(s=this.sendTime.split("-")[1],0==this.timeTabIndex)t=new Date,"24:00"==s&&(s="23:59");else{if(this.timeTabIndex>2){t=new Date;var i=this.sendTime.split(" ");return t.getFullYear()+"-"+i[0]+" "+i[1].split("-")[1]}t=new Date(e.getTime()+864e5*this.timeTabIndex),"24:00"==s&&(s="23:59")}return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+s},goExpressGoods:function(){e.navigateTo({url:"expressGoods"})},getDefault:function(){var e=this;e.$util.networkRequest({url:"/AddressBook/GetDefault",success:function(t){if(!e.$util.isNotEmpty(t))return!1;e.sendInfo={name:t.name,contactsCode:t.contactsCode,address:t.areaInfo.province+t.areaInfo.city+t.areaInfo.area+t.address,ad:t.address,areaCode:t.areaInfo.areaCode},e.$store.state.expressDeliveryInfo.sendAddress=e.sendInfo}})},isRegister:function(){var e=this;e.$util.networkRequest({url:"/Company/IsRegister",success:function(t){t&&e.expressTypeData.push("企业")}})},getCarListAll:function(){var e=this;e.carList=[],e.carSubList=[],e.swiperIndex=0,e.carName="",e.$util.networkRequest({url:"/ExpressCar/GetCarListAll",data:{companyCode:e.expressCompany.code},success:function(t){if(0==t.length)return!1;var s=[],i={},n=0;t.forEach((function(e,t){i.hasOwnProperty(e.carName)?s[i[e.carName]]["list"].push(e):(i[e.carName]=n++,s.push({parentCareName:e.parentCareName,carName:e.carName,list:[e]}))})),e.swiperItems=s.length>=5?5:s.length,e.carList=s,e.carSubList=s[0].list,e.carIndex=0,e.carCode=e.carSubList[0].carCode}})},getExpressCompany:function(){var e=this;e.expressCompany={list:[],range:[],index:0,code:"",path:"",agreementUrl:"",companyName:"",insuranceUpper:0},e.$util.networkRequest({url:"/ExpressCar/GetCompanyList",success:function(t){if(0==t.length)return!1;var s=e.expressCompany.index;if(""!==e.istc)for(var i=0;i<t.length;i++)t[i].companyCode==e.istc&&(s=i);else if(""!=e.companyCodeStorage)for(i=0;i<t.length;i++)t[i].companyCode==e.companyCodeStorage&&(s=i);var n=t[s];e.expressCompany.list=t,e.expressCompany.code=n.companyCode,e.expressCompany.companyName=n.companyName,e.expressCompany.insuranceUpper=n.insuranceUpper,e.expressCompany.path=n.logoPath.replace(/\s*/g,""),e.expressCompany.agreementUrl=n.agreementUrl,e.clauseHtml=n.agreementContent,e.startTime=n.startTime,e.endTime=n.endTime,e.initServiceData(),e.getCarListAll(),e.setDate("",e.endTime),e.setCompanyValue(s),t.forEach((function(t,s){e.expressCompany.range.push(t.companyName)}))}})},initServiceData:function(){var e=this;"{}"==JSON.stringify(this.$store.state.expressDeliveryInfo.service)&&(e.serviceList=[],e.$util.networkRequest({url:"/ExpressCar/GetExpressServiceList",data:{companyCode:e.expressCompany.code},success:function(t){t.forEach((function(t){var s=t.listDetail[0];"db001"==e.expressCompany.code&&"DeliveryType"==t.serviceKey&&t.listDetail.forEach((function(e){"送货（不含上楼）"==e.remark&&(s=e)})),e.serviceList.push({remark:s.remark,serviceKey:s.serviceKey,serviceValue:s.serviceValue})}))}}))},Valid:function(){return this.$util.isNotEmpty(this.sendInfo.contactsCode)?this.$util.isNotEmpty(this.repInfo.contactsCode)?this.$util.isNotEmpty(this.carName)?"{}"==JSON.stringify(this.goodInfoData)?(this.$util.showToast("请填写物品信息"),!1):null==this.insuredPrice?(this.$util.showToast("请填写保价信息"),!1):!!this.checkedAgree||(this.$util.showToast("请详细阅读条款并勾选"),!1):(this.$util.showToast("请选择车辆类型"),!1):(this.$util.showToast("收件人不能为空"),!1):(this.$util.showToast("寄件人不能为空"),!1)},getYshESAgree:function(){var e=this;e.$util.networkRequest({url:"/ExpressCompany/GetYshESAgree",success:function(t){e.agreeHtml=t}})},getYMD:function(){var e=new Date;this.tabTimeArr=["今天","明天","后天"];for(var t=e.getMonth()+1,s=new Date(e.getFullYear(),t,0).getDate(),i=0,n=3;n<7;n++){var r=t,a=e.getDate()+n,o=a;a>s&&(i++,o=i,r=t+1),this.tabTimeArr.push(r+"-"+o)}},emptyData:function(){this.goodName="",this.insuredPrice=null,this.serviceNames="",this.checkedAgree=!1,this.$store.state.expressDeliveryInfo={type:"",companyCode:"",expectTime:"",sendAddress:{},repAddress:{},goodInfo:{},insuredPrice:{},service:{},carType:{}}}}};t.default=n}).call(this,s("543d")["default"])},8779:function(e,t,s){"use strict";s.r(t);var i=s("6f06"),n=s.n(i);for(var r in i)"default"!==r&&function(e){s.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a},af276:function(e,t,s){"use strict";var i=s("33a4"),n=s.n(i);n.a},d008:function(e,t,s){"use strict";var i,n=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.isCarType=!0},e.e1=function(t){e.checkedAgree=!e.checkedAgree},e.e2=function(t){e.isAagree=!0},e.e3=function(t){e.isClause=!0},e.e4=function(t){e.isAagree=!1},e.e5=function(t){e.isClause=!1},e.e6=function(t){e.isCarType=!1})},r=[];s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return r})),s.d(t,"a",(function(){return i}))},ef39:function(e,t,s){"use strict";s.r(t);var i=s("d008"),n=s("8779");for(var r in n)"default"!==r&&function(e){s.d(t,e,(function(){return n[e]}))}(r);s("af276");var a,o=s("f0c5"),c=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"121f75e1",null,!1,i["a"],a);t["default"]=c.exports}},[["32e2","common/runtime","common/vendor"]]]);