(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/batchSend/index"],{5643:function(e,s,t){"use strict";t.r(s);var o=t("e0d9"),i=t("704b");for(var n in i)"default"!==n&&function(e){t.d(s,e,(function(){return i[e]}))}(n);t("f885");var r,a=t("f0c5"),d=Object(a["a"])(i["default"],o["b"],o["c"],!1,null,"46895976",null,!1,o["a"],r);s["default"]=d.exports},"704b":function(e,s,t){"use strict";t.r(s);var o=t("e2eb"),i=t.n(o);for(var n in o)"default"!==n&&function(e){t.d(s,e,(function(){return o[e]}))}(n);s["default"]=i.a},"93d6":function(e,s,t){"use strict";(function(e){t("b397");o(t("66fd"));var s=o(t("5643"));function o(e){return e&&e.__esModule?e:{default:e}}e(s.default)}).call(this,t("543d")["createPage"])},d4bf:function(e,s,t){},e0d9:function(e,s,t){"use strict";var o,i=function(){var e=this,s=e.$createElement;e._self._c;e._isMounted||(e.e0=function(s){e.isEstimate=!1},e.e1=function(s){e.isCompanyPassword=!1},e.e2=function(s){e.isCompanyPassword=!1})},n=[];t.d(s,"b",(function(){return i})),t.d(s,"c",(function(){return n})),t.d(s,"a",(function(){return o}))},e2eb:function(e,s,t){"use strict";(function(e){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var o=function(){t.e("components/sendTime-picker/sendTime-picker").then(function(){return resolve(t("a768"))}.bind(null,t)).catch(t.oe)},i={data:function(){return{type:"",sendInfo:{name:"寄件人信息",contactsCode:"",address:"点击填写寄件地址",ad:"",areaCode:""},expressTypeData:["请选择","个人"],expressTypeIndex:0,isShowxs:!1,popupShow:!1,startTime:8,endTime:19,setPickerIndex:[0],timeTabIndex:0,sendTime:"一小时内",expressCompany:{list:[],range:[],index:0,code:"",path:"",agreementUrl:"",companyName:"",insuranceUpper:0},serviceNames:"",serviceList:[],orderList:[],isEstimate:!1,estimateDataList:[],activeIndex:0,orderIndex:0,estimateName:"",estimatePrice:0,checked:!1,goodMemo:"",isCompanyPassword:!1,sumMoney:"",password:"",istc:"",multiple:1,preserveTypeData:[]}},components:{sendTimePicker:o},onLoad:function(s){if(this.type="big",this.istc=void 0==s.companyCode?"":s.companyCode,""==this.istc){var t=e.getStorageSync("expressStorage");""!=t&&void 0!=t&&(this.expressModeStorage=JSON.parse(t).expressMode,this.companyCodeStorage=JSON.parse(t).companyCode,this.$store.state.batchOrderInfo.companyCode=this.companyCodeStorage)}this.isRegister(),this.getExpressCompany()},onShow:function(){var e=getApp();e.isToken(),this.showImage=e.globalData.isDiscountPopup,this.init()},methods:{init:function(){var s=this,t=e.getStorageSync("batchSendInfo");""!=t&&void 0!=t&&(t=JSON.parse(t),this.$store.state.batchOrderInfo=t,this.$store.state.expressDeliveryInfo.sendAddress=t.sendAddress,this.$store.state.expressDeliveryInfo.service=t.service,this.companyCodeStorage=t.companyCode,e.removeStorageSync("batchSendInfo"));var o=this.$store.state.expressDeliveryInfo,i=o.sendAddress,n=o.repAddress,r=o.service,a=this.$store.state.batchOrderInfo;if(this.orderList=this.$store.state.batchOrderInfo["list"],"{}"==JSON.stringify(i)?this.getDefault():this.sendInfo=i,""!=a.companyCode)for(var d=0;d<this.expressCompany.list.length;d++)this.expressCompany.list[d].companyCode==a.companyCode&&this.setCompanyValue(d);if("{}"!=JSON.stringify(r)){this.serviceList=[];var p="";r.forEach((function(e){if("TakeBill"==e.serviceKey)return!1;var t=e.sub.remark.replace(/ /g,"");p+=t+"-",s.serviceList.push(e.sub),"PayType"==e.sub.serviceKey&&(s.paytype=e.sub.remark)})),this.serviceNames=p.substring(0,p.length-1)}if("{}"!=JSON.stringify(n)){var c={repAddress:n,goodsInfo:{isWP:!1,isWeight:!1,isMoney:!1},type:{productName:"产品类型",price:""}};if(a["list"].length>0){var m=a["list"][0];m.goodsInfo.isWP&&(c.goodsInfo["isWP"]=!0,c.goodsInfo["info"]=m.goodsInfo.info),m.goodsInfo.isWeight&&(c.goodsInfo["isWeight"]=!0,c.goodsInfo["volume"]=m.goodsInfo.volume),m.goodsInfo.isMoney&&(c.goodsInfo["isMoney"]=!0,c.goodsInfo["money"]=m.goodsInfo.money)}var h=e.getStorageSync("addressEdit");""!=h&&void 0!=h?(e.removeStorageSync("addressEdit"),this.orderList[h].repAddress=n):this.orderList=this.orderList.concat(c),this.$store.state.batchOrderInfo["list"]=this.orderList,this.$store.state.expressDeliveryInfo.repAddress={}}this.forEachEstimate()},orderNow:function(){var s=this;if(console.log(s.serviceList),0==s.orderList.length)return s.$util.showToast("填写收件信息"),!1;var t=[];s.sumMoney=0;for(var o=0;o<s.orderList.length;o++){var i=s.orderList[o];if(void 0==i.goodsInfo.info||void 0==i.goodsInfo.money||void 0==i.goodsInfo.volume)return s.$util.showToast("第"+(o+1)+"个订单,未选填货品信息"),!1;if(void 0==i.type.productType)return s.$util.showToast("第"+(o+1)+"个订单,未选择产品类型"),!1;if("db001"==s.expressCompany.code&&1==s.checked&&""==i.goodsInfo.info.materialTxt)return s.$util.showToast("第"+(o+1)+"个订单,未选择包装材质"),!1;s.sumMoney+=parseFloat(parseFloat(i.type.price)+parseFloat(""==i.type.insurancePrice?0:i.type.insurancePrice));var n={toContactsCode:i.repAddress.contactsCode,estimateGoods:{weight:i.goodsInfo.volume.txtweight,volume:i.goodsInfo.volume.volume,category:i.goodsInfo.info.goodType,name:i.goodsInfo.info.goodName,count:i.goodsInfo.volume.txtnum},insurance:i.goodsInfo.money.amount,packageService:i.goodsInfo.info.materialTxt,productType:i.type.productType};t.push(n)}if(2==this.expressTypeIndex&&""==this.password){var r=!0;if(this.serviceList.forEach((function(e){"PayType"==e.serviceKey&&1==e.serviceValue&&(r=!1)})),r)return this.isCompanyPassword=!0,!1;this.isCompanyPassword=!1}else this.isCompanyPassword=!1;e.showLoading({title:"正在批量下单",mask:!0});var a=this.expectedTime(),d={fromContactsCode:s.sendInfo.contactsCode,sendTime:a,companyCode:s.expressCompany.code,expressMode:s.expressTypeIndex,memo:s.goodMemo,serviceList:s.serviceList,isBillExpress:s.checked,orderList:t,password:s.password};s.password="",s.$util.networkRequest({url:"/Express/BatchPostApp",method:"POST",data:d,success:function(t){console.log("立即下单:",t);var o={expressMode:s.expressTypeIndex,companyCode:s.expressCompany.code};e.setStorage({key:"expressStorage",data:JSON.stringify(o)}),s.emptyData(),e.switchTab({url:"/pages/order/orderList"})},error:function(t){2001==t.errCode&&e.showModal({title:"提示",content:t.message,showCancel:!1,success:function(t){e.setStorage({key:"batchSendInfo",data:JSON.stringify(s.$store.state.batchOrderInfo)}),e.navigateTo({url:"/pages/me/myRefill?type=batch"})}})}})},emptyData:function(){this.$store.state.batchOrderInfo={list:[],companyCode:"",sendAddress:{}}},addressPage:function(s,t,o,i){if(0==s){var n="";"send"==t&&(n=this.sendInfo.contactsCode),"rep"==t&&(n=o,e.setStorage({key:"addressEdit",data:String(i)})),e.navigateTo({url:"/pages/me/addressEdit?addresscode="+n+"&type="+t})}if(1==s){var r=this.sendInfo.contactsCode;console.log(r),e.navigateTo({url:"/pages/me/addressList?code="+r+"&type="+t})}},goGoods:function(s){var t=this.expectedTime();this.$store.state.batchOrderInfo.expectTime=t,this.$store.state.batchOrderInfo.service=this.$store.state.expressDeliveryInfo.service,this.$store.state.batchOrderInfo.sendAddress=this.sendInfo,this.$store.state.batchOrderInfo.expressTypeIndex=this.expressTypeIndex,e.navigateTo({url:"/pages/batchSend/batchGoodsInfo?key="+s+"&upperAmount="+this.expressCompany.insuranceUpper+"&code="+this.expressCompany.code})},orderRemove:function(s){var t=this;e.showModal({title:"提示",content:"您确定要删除吗？",success:function(e){e.confirm&&(t.orderList=t.orderList.filter((function(e,t){return t!=s})),t.$store.state.batchOrderInfo["list"]=t.orderList)}})},choiceEstimate:function(e,s){this.activeIndex=e,this.estimatePrice=s.price,this.preserveTypeData=s},typePreserve:function(){this.isEstimate=!1,this.orderList[this.orderIndex].type=this.preserveTypeData,this.orderList[this.orderIndex].type["index"]=this.activeIndex},setData:function(e,s){var t=this,o=t.orderList[e],i=this.expectedTime(),n=o.goodsInfo.volume.txtweight<20&&void 0==o.goodsInfo.money?0:o.goodsInfo.money.amount,r={ExpressMode:t.expressTypeIndex,areaCodeFrom:t.sendInfo.areaCode,fromAddress:t.sendInfo.ad,toAddress:o.repAddress.ad,areaCodeTo:o.repAddress.areaCode,companyCode:t.expressCompany.code,insuranceValue:n,sendTime:i,volume:o.goodsInfo.volume.volume<=0?0:o.goodsInfo.volume.volume,serviceDeliveryTypeInfo:this.serviceList,weight:o.goodsInfo.volume.txtweight};t.$util.networkRequest({url:"/Price/EstimatePrice",method:"POST",data:r,success:function(e){s&&s(e)}})},forEachEstimate:function(){var s=this,t=this.orderList;s.activeIndex=0,e.showLoading({mask:!0}),0==t.length&&e.hideLoading(),t.forEach((function(t,o){return void 0==JSON.stringify(t.goodsInfo.volume)?(e.hideLoading(),!1):t.goodsInfo.volume.txtweight>20&&void 0==t.goodsInfo.money?(e.hideLoading(),!1):void s.setData(o,(function(e){s.orderList[o].type=e[0],s.orderList[o].type["index"]=0}))}))},bindEstimate:function(s){var t=this,o=t.orderList[s];this.orderIndex=s;var i=void 0==o.type.index?0:o.type.index;return void 0==JSON.stringify(o.goodsInfo.volume)?(t.$util.showToast("请选填货品信息"),!1):o.goodsInfo.volume.txtweight>20&&void 0==o.goodsInfo.money?(t.$util.showToast("预估重量大于20公斤,保费为必填"),!1):(t.activeIndex=0,t.estimateName=o.goodsInfo.info.goodName,e.showLoading({title:"加载中...",mask:!0}),void t.setData(s,(function(e){t.isEstimate=!0,e.length>1&&(t.multiple=2),t.estimatePrice=e[i].price,t.activeIndex=i,t.estimateDataList=e,t.preserveTypeData=e[i]})))},expressCompanyPickerChange:function(e){var s=e.detail.value;this.$store.state.expressDeliveryInfo.expectTime="",this.setCompanyValue(s),this.$store.state.batchOrderInfo.companyCode=this.expressCompany.list[s].companyCode,this.$store.state.expressDeliveryInfo.service={},this.serviceNames="",this.initServiceData(),this.forEachEstimate()},setCompanyValue:function(e){var s=this.expressCompany.list[e].companyCode,t=this.expressCompany.list[e].startTime,o=this.expressCompany.list[e].endTime,i=this.expressCompany.list[e].logoPath,n=this.expressCompany.list[e].agreementUrl;this.expressCompany.index=e,this.expressCompany.code=s,this.expressCompany.path=i.replace(/\s*/g,""),this.expressCompany.agreementUrl=n,this.expressCompany.companyName=this.expressCompany.list[e].companyName,this.expressCompany.insuranceUpper=this.expressCompany.list[e].insuranceUpper,this.clauseHtml=this.expressCompany.list[e].agreementContent,this.startTime=t,this.endTime=o,this.setPickerIndex=[0],this.setDate(s,o)},open:function(){this.popupShow=!0},close:function(){this.popupShow=!1},timeChange:function(e){this.setPickerIndex=[Number(e.pickerIndex)],this.sendTime=e.txt,this.timeTabIndex=e.tabIndex,this.forEachEstimate()},expressTypeChange:function(e){this.expressTypeIndex=e.target.value,this.$store.state.expressDeliveryInfo.type=e.target.value,this.countYHQ=1==this.expressTypeIndex?this.couponCountUser:this.couponCountCompany,0==this.expressTypeIndex&&(this.estimatePriceList=[]),this.forEachEstimate()},isRegister:function(){var e=this;e.$util.networkRequest({url:"/Company/IsRegister",success:function(s){s?(e.isShowxs=!0,e.expressTypeData.push("企业")):(e.isShowxs=!1,e.expressTypeIndex=1),0!==e.expressModeStorage&&(2==e.expressModeStorage?e.expressTypeIndex=3==e.expressTypeData.length?e.expressModeStorage:1:e.expressTypeIndex=e.expressModeStorage),e.expressTypeIndex=void 0==e.expressTypeIndex?1:e.expressTypeIndex,e.$store.state.expressDeliveryInfo.type=e.expressTypeIndex}})},getExpressCompany:function(){var e=this;e.expressCompany={list:[],range:[],index:0,code:"",path:"",agreementUrl:"",companyName:"",insuranceUpper:0},e.$util.networkRequest({url:"/ExpressCompany/GetList",data:{companyType:"Big"},success:function(s){var t=e.expressCompany.index;if(""!==e.istc)for(var o=0;o<s.length;o++)s[o].companyCode==e.istc&&(t=o);else for(o=0;o<s.length;o++)s[o].companyCode==e.companyCodeStorage&&(t=o);var i=s[t];e.expressCompany.list=s,e.expressCompany.code=i.companyCode,e.expressCompany.companyName=i.companyName,e.expressCompany.insuranceUpper=i.insuranceUpper,e.expressCompany.path=i.logoPath.replace(/\s*/g,""),e.expressCompany.agreementUrl=i.agreementUrl,e.clauseHtml=i.agreementContent,e.startTime=i.startTime,e.endTime=i.endTime,e.initServiceData(),e.setDate("",e.endTime),e.setCompanyValue(t),s.forEach((function(s,t){e.expressCompany.range.push(s.companyName)}))}})},initServiceData:function(){var e=this;"{}"==JSON.stringify(this.$store.state.expressDeliveryInfo.service)&&(e.serviceList=[],e.$util.networkRequest({url:"/ExpressService/GetList",data:{companyCode:e.expressCompany.code},success:function(s){s.forEach((function(s){var t=s.listDetail[0];if("db001"==e.expressCompany.code&&"DeliveryType"==s.serviceKey&&s.listDetail.forEach((function(e){"送货（不含上楼）"==e.remark&&(t=e)})),"TakeBill"==s.serviceKey)return!1;e.serviceList.push({remark:t.remark,serviceKey:t.serviceKey,serviceValue:t.serviceValue})}))}}))},setDate:function(e,s){var t="",o=this.$store.state.expressDeliveryInfo.expectTime;""==o?(this.timeTabIndex=0,this.sendTime=""==e||"sf001"==e||"ky001"==e?t+" 一小时内":t+" 两小时内"):this.sendTime=o},checkboxChange:function(e){this.checked=!this.checked},goService:function(){e.navigateTo({url:"/pages/index/addedService?code="+this.expressCompany.code+"&type=1"})},expectedTime:function(){var e=new Date,s="",t="";if(-1!=this.sendTime.indexOf("小时")){if(1==this.timeTabIndex)s=new Date(e.getTime()+864e5),t=this.startTime+":00";else{if("sf001"==this.expressCompany.code||"ky001"==this.expressCompany.code){if(this.endTime-1<(new Date).getHours()&&(new Date).getHours()<this.endTime)return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+this.endTime+":00";s=new Date(e.getTime()+36e5)}else{if(this.endTime-2<(new Date).getHours()&&(new Date).getHours()<this.endTime)return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+this.endTime+":00";s=new Date(e.getTime()+72e5)}t=s.getHours()+":"+s.getMinutes()}}else t=this.sendTime.split("-")[1],0==this.timeTabIndex?(s=new Date,"24:00"==t&&(t="23:59")):(s=new Date(e.getTime()+864e5*this.timeTabIndex),"24:00"==t&&(t="23:59"));return s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+t},getDefault:function(){var e=this;e.$util.networkRequest({url:"/AddressBook/GetDefault",success:function(s){if(!e.$util.isNotEmpty(s))return!1;e.sendInfo={name:s.name,contactsCode:s.contactsCode,address:s.areaInfo.province+s.areaInfo.city+s.areaInfo.area+s.address,ad:s.address,areaCode:s.areaInfo.areaCode},e.$store.state.batchOrderInfo.sendAddress=e.sendInfo}})},passwordInput:function(e){this.password=e.detail.value}}};s.default=i}).call(this,t("543d")["default"])},f885:function(e,s,t){"use strict";var o=t("d4bf"),i=t.n(o);i.a}},[["93d6","common/runtime","common/vendor"]]]);